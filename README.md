# Система автоматического бронирования столов

## О проекте

Спроектирован и разработан прототип микросервисной системы автоматического бронирования. Система реализует
интеллектуальный алгоритм подбора столов с автоматическим предложением альтернативных вариантов при отсутствии мест на выбранное время.

## Архитектура и Технологический Стек
### Сервисы
- **Client** (client): Обрабатывает CRUD-операции, хранит и передает заявки пользователей в сервис бронирования.
- **Booking service** (server-side): Обрабатывает входящие заявки из клиентского сервиса и CRUD-операции для менеджеров ресторана.
### Технологии
- Backend: Java, Spring Boot 3.x
- База данных: PostgreSQL
- Мессенджер: Apache Kafka
- Миграции БД: Liquibase
- API: REST

## Ключевые особенности

- **Модульная архитектура** с четким разделением ответственности
- **Три альтернативные реализации** сервиса бронирования с единым интерфейсом
- **Асинхронная коммуникация** через Kafka для обеспечения отказоустойчивости
- **Интеллектуальный алгоритм** подбора столов с альтернативными предложениями
- **Автоматическая обработка** временных резервов и waitlist-механизмов

## Принцип работы

### Входной запрос

На вход сервис получает запрос на бронирование, содержащий:

- Время бронирования
- Продожительность
- Количество человек
- Дополнительные параметры

### Процесс обработки

1. **Валидация** - запрос проверяется в сервисе заявок
2. **Асинхронная передача** - валидированный запрос передается через Kafka
3. **Обработка бронирования** - один из трех сервисов обрабатывает запрос

### Варианты результата обработки

#### Успешное бронирование

- Сервис находит подходящее окно
- Отправляет подтверждение в сервис заявок
- Работа завершается

#### Альтернативные предложения

- Подходящих окон нет, но есть похожие (±1 час)
- Окна резервируются на 10 минут
- Предложения отправляются клиенту
- При подтверждении одного окна остальные освобождаются
- При отсутствии подтверждения - окна автоматически освобождаются

#### WaitList предложение

- Ни подходящих, ни похожих окон не найдено
- Клиенту предлагается встать в WaitList

## Реализация сервиса бронирования

### Time-Graph

**Подход:** In-memory графовая структура для оптимизации поиска

**Структура данных:**

```java
ConcurrentMap<LocalDate, ConcurrentMap<Integer, ConcurrentMap<Integer, BookingSlot>>>
``` 

**Ключевые особенности:**

- Высокая производительность (in-memory операции)
- Потокобезопасность через locking
- Ежедневное обновление графа

**Оптимизации:**

- Разделение блокировок по датам
- TryLock для runtime операций
- Lock для фоновых задач

**Преимущества:**

- Минимальная нагрузка на базу данных
- Высокая производительность
- Эффективное управление concurrent access

**Недостатки:**
- Невозможность горизонтального масштабирования
- Поддержание согласованности данных в БД и графе
